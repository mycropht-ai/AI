<?xml version="1.0" encoding="utf-8"?>
<Database>
    <BehaviorTrees>
        <Row TreeName="Settle New Town v2" />
    </BehaviorTrees>
    <BehaviorTreeNodes>
        <Row TreeName="Settle New Town v2" NodeId="0" NodeType="Sequence" JumpTo="33" />
        <Row TreeName="Settle New Town v2" NodeId="1" NodeType="Concurrent" JumpTo="27" />
        <Row TreeName="Settle New Town v2" NodeId="2" NodeType="Decode Input" />
        <Row TreeName="Settle New Town v2" NodeId="3" NodeType="CheckSettleLocationValid" />
        <Row TreeName="Settle New Town v2" NodeId="4" NodeType="Sequence" JumpTo="27" />
        <Row TreeName="Settle New Town v2" NodeId="5" NodeType="Concurrent" JumpTo="8" />
        <Row TreeName="Settle New Town v2" NodeId="6" NodeType="Research Progression Node" />
        <Row TreeName="Settle New Town v2" NodeId="7" NodeType="Operation Recruit Units" />
        <Row TreeName="Settle New Town v2" NodeId="8" NodeType="Operation Recruit Units" />
        <Row TreeName="Settle New Town v2" NodeId="9" NodeType="Sequence" JumpTo="27" />
        <Row TreeName="Settle New Town v2" NodeId="10" NodeType="Priority" JumpTo="16" />
        <!-- Removed nodes 11-15 (naval escort logic) -->
        <Row TreeName="Settle New Town v2" NodeId="16" NodeType="Concurrent" JumpTo="27" />
        <Row TreeName="Settle New Town v2" NodeId="17" NodeType="CheckSettleLocationValid" />
        <Row TreeName="Settle New Town v2" NodeId="18" NodeType="Operation Form Army" />
        <Row TreeName="Settle New Town v2" NodeId="19" NodeType="Operation Recruit Units" />
        <Row TreeName="Settle New Town v2" NodeId="20" NodeType="Priority" JumpTo="24" />
        <Row TreeName="Settle New Town v2" NodeId="21" NodeType="Not" JumpTo="23" />
        <Row TreeName="Settle New Town v2" NodeId="22" NodeType="Army Must Unpack" />
        <Row TreeName="Settle New Town v2" NodeId="23" NodeType="Operation Unpack Army" />
        <Row TreeName="Settle New Town v2" NodeId="24" NodeType="Operation Defend Units" />
        <Row TreeName="Settle New Town v2" NodeId="25" NodeType="Operation Attack Units" />
        <Row TreeName="Settle New Town v2" NodeId="26" NodeType="Operation Move Army" />
        <Row TreeName="Settle New Town v2" NodeId="27" NodeType="Concurrent" JumpTo="33" />
        <Row TreeName="Settle New Town v2" NodeId="28" NodeType="CheckSettleLocationValid" />
        <Row TreeName="Settle New Town v2" NodeId="29" NodeType="Operation Unpack Army" />
        <Row TreeName="Settle New Town v2" NodeId="30" NodeType="Operation Defend Units" />
        <Row TreeName="Settle New Town v2" NodeId="31" NodeType="Operation Attack Units" />
        <Row TreeName="Settle New Town v2" NodeId="32" NodeType="Operation Move Army" />
        <Row TreeName="Settle New Town v2" NodeId="33" NodeType="DiplomaticActionLandClaim" />
    </BehaviorTreeNodes>

    <TreeData>
        <Row DefnId="0" NodeId="2" TreeName="Settle New Town v2" />
        <Row DefnId="1" NodeId="2" TreeName="Settle New Town v2" />
        <Row DefnId="2" NodeId="2" TreeName="Settle New Town v2" />
        <Row DefnId="3" NodeId="2" TreeName="Settle New Town v2" Tag="SettleLocation" />
        <Row DefnId="4" NodeId="2" TreeName="Settle New Town v2" />
        <Row DefnId="5" NodeId="2" TreeName="Settle New Town v2" />
        <Row DefnId="0" NodeId="3" TreeName="Settle New Town v2" Tag="SettleLocation" />
        <Row DefnId="1" NodeId="5" TreeName="Settle New Town v2" DefaultData="true" />
        <Row DefnId="0" NodeId="6" TreeName="Settle New Town v2" />
        <Row DefnId="1" NodeId="6" TreeName="Settle New Town v2" DefaultData="UNIT_CLASS_CREATE_TOWN" />
        <Row DefnId="2" NodeId="6" TreeName="Settle New Town v2" DefaultData="10" />
        <Row DefnId="0" NodeId="7" TreeName="Settle New Town v2" DefaultData="false" />
        <Row DefnId="2" NodeId="7" TreeName="Settle New Town v2" DefaultData="true" />
        <Row DefnId="3" NodeId="7" TreeName="Settle New Town v2" DefaultData="10" />
        <Row DefnId="4" NodeId="7" TreeName="Settle New Town v2" DefaultData="true" />
        <Row DefnId="0" NodeId="8" TreeName="Settle New Town v2" DefaultData="false" />
        <Row DefnId="2" NodeId="8" TreeName="Settle New Town v2" DefaultData="true" />
        <Row DefnId="3" NodeId="8" TreeName="Settle New Town v2" DefaultData="10" />
        <Row DefnId="4" NodeId="8" TreeName="Settle New Town v2" DefaultData="true" />
        <!-- Removed TreeData for nodes 11-15 -->
        <Row DefnId="0" NodeId="17" TreeName="Settle New Town v2" Tag="SettleLocation" />
        <Row DefnId="0" NodeId="18" TreeName="Settle New Town v2" DefaultData="true" />
        <Row DefnId="0" NodeId="19" TreeName="Settle New Town v2" DefaultData="true" />
        <Row DefnId="1" NodeId="19" TreeName="Settle New Town v2" DefaultData="-1" />
        <Row DefnId="3" NodeId="19" TreeName="Settle New Town v2" DefaultData="-1" />
        <Row DefnId="4" NodeId="19" TreeName="Settle New Town v2" DefaultData="false" />
        <Row DefnId="0" NodeId="25" TreeName="Settle New Town v2" DefaultData="false" />
        <Row DefnId="0" NodeId="26" TreeName="Settle New Town v2" DefaultData="0" />
        <Row DefnId="1" NodeId="26" TreeName="Settle New Town v2" DefaultData="false" />
        <Row DefnId="3" NodeId="26" TreeName="Settle New Town v2" DefaultData="UNIT_CLASS_CREATE_TOWN" />
        <!-- Reduce wait time on movement operations 
		Default 5, Changing to 2 -->
		<Row DefnId="4" NodeId="26" TreeName="Settle New Town v2" DefaultData="2" />
        <Row DefnId="0" NodeId="28" TreeName="Settle New Town v2" DefaultData="false" />
        <Row DefnId="0" NodeId="32" TreeName="Settle New Town v2" DefaultData="0" />
        <Row DefnId="1" NodeId="32" TreeName="Settle New Town v2" DefaultData="false" />
        <Row DefnId="3" NodeId="32" TreeName="Settle New Town v2" DefaultData="UNIT_CLASS_CREATE_TOWN" />
        <!-- Reduce wait time on movement operations 
		Default 5, Changing to 2 -->
		<Row DefnId="4" NodeId="32" TreeName="Settle New Town v2" DefaultData="5" />
        <Row DefnId="0" NodeId="33" TreeName="Settle New Town v2" Tag="SettleUnit" />
        <Row DefnId="1" NodeId="33" TreeName="Settle New Town v2" Tag="SettleLocation" />

    </TreeData>

    <AiOperationDefs>
        <Update>
            <Where OperationName="City Founding" />
            <Set BehaviorTree="Settle New Town v2" />
        </Update>
		<!-- Default 5, if lower will attack too quick -->
		<Update>
			<Where OperationName="Attack Enemy City"/>
			<Set MustHaveUnits="6"/>
		</Update>
		<Update>
			<Where OperationName="City Founding"/>
			<Set Priority="4"/>
		</Update>
    </AiOperationDefs>

	<OpTeamRequirements>
		<!-- 
		ENEMY CITY ATTACK
		Existing rows: UNIT_CLASS_MELEE, UNIT_CLASS_RANGED, etc.
		We update those where they exist, and add a new row for settlers (which doesnâ€™t exist in base).
		-->
		<!-- Increase melee min from 2 to 3 and cap at 6 -->
		<Update>
			<Where TeamName="Enemy City Attack" ClassTag="UNIT_CLASS_MELEE"/>
			<Set MinNumber="3" MaxNumber="6"/>
		</Update>

		<!-- Increase ranged max from 3 to 12 -->
		<Update>
			<Where TeamName="Enemy City Attack" ClassTag="UNIT_CLASS_RANGED"/>
			<Set MaxNumber="12"/>
		</Update>

		<!-- Exclude settlers: This row doesn't exist in base, so we add it -->
		<Row TeamName="Enemy City Attack" ClassTag="UNIT_CLASS_CREATE_TOWN" Property="LandClaimCharges" MaxNumber="0"/>


		<!-- 
		INDEPENDENT CAMP ATTACK
		Similar logic: update existing melee/ranged rows, add row for settlers.
		-->
		<!-- Raise melee min from 1 to 3, cap at 6 -->
		<Update>
			<Where TeamName="Independent Camp Attack" ClassTag="UNIT_CLASS_MELEE"/>
			<Set MinNumber="3" MaxNumber="6"/>
		</Update>

		<!-- Increase ranged max from 2 to 12 -->
		<Update>
			<Where TeamName="Independent Camp Attack" ClassTag="UNIT_CLASS_RANGED"/>
			<Set MaxNumber="12"/>
		</Update>

		<!-- Exclude settlers -->
		<Row TeamName="Independent Camp Attack" ClassTag="UNIT_CLASS_CREATE_TOWN" Property="LandClaimCharges" MaxNumber="0"/>


		<!-- 
		CITY DEFENSE
		Base game has no entries for Melee, Ranged, Siege, Healer, or Settler with LandClaimCharges.
		We add them as new rows to encourage balanced defensive forces and exclude settlers.
		-->
		<!-- Exclude settlers -->
		<Row TeamName="City Defense" ClassTag="UNIT_CLASS_CREATE_TOWN" Property="LandClaimCharges" MaxNumber="0"/>

		<!-- New row for melee defense (at least some direct defenders, but not too many) -->
		<Row TeamName="City Defense" ClassTag="UNIT_CLASS_MELEE" MinNumber="1" MaxNumber="4"/>

		<!-- New row for ranged defense (ensures basic ranged coverage) -->
		<Row TeamName="City Defense" ClassTag="UNIT_CLASS_RANGED" MinNumber="1" MaxNumber="3"/>

		<!-- Optional: allow up to 2 siege units to help defend -->
		<Row TeamName="City Defense" ClassTag="UNIT_CLASS_SIEGE" MaxNumber="2"/>

		<!--
		CITY FOUNDING
		We lower number of military units for founding a new city as settlers get stuck moving around.
		-->
		<!-- Max military units for founding a new city to 1 -->
		<Update>
			<Where TeamName="City Founding" ClassTag="UNIT_CLASS_COMBAT"/>
			<Set MaxNumber="1"/>
		</Update>

	</OpTeamRequirements>

</Database>